<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Connexion</title>
    <link rel="stylesheet" href="../../assets/style/style.css">
    <style>
    .login-container {
        background: rgba(255,255,255,0.10);
        border-radius: 16px;
        padding: 40px 32px 32px 32px;
        box-shadow: 0 8px 32px 0 rgba(31,38,135,0.37);
        text-align: center;
        max-width: 350px;
        margin: 80px auto;
    }
    .login-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 18px;
    }
    .login-tab {
        flex: 1;
        padding: 10px 0;
        cursor: pointer;
        font-weight: 600;
        background: #fff;
        color: #5563DE;
        border: none;
        border-radius: 8px 8px 0 0;
        margin: 0 2px;
        transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 140px;
        box-shadow: 0 2px 8px rgba(85,99,222,0.08);
    }
    .login-tab:hover {
        background: #5563DE;
        color: #fff;
        box-shadow: 0 4px 16px rgba(85,99,222,0.18);
    }
    .login-tab.active {
        background: #5563DE;
        color: #fff;
        box-shadow: 0 4px 16px rgba(85,99,222,0.18);
    }
    .login-form input {
        width: 90%;
        padding: 10px;
        margin: 10px 0 18px 0;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 1rem;
    }
    .login-form button {
        width: 100%;
    }
    </style>
</head>
<body class="menu-bg">
    <div class="login-container">
        <div class="login-tabs">
            <button class="login-tab active" id="tab-login">Connexion</button>
            <button class="login-tab" id="tab-register">Créer un compte</button>
        </div>
        <form class="login-form" id="loginForm">
            <input type="text" id="loginUser" placeholder="Nom d'utilisateur" required autocomplete="username">
            <input type="password" id="loginPass" placeholder="Mot de passe" required autocomplete="current-password">
            <button type="submit" class="button">Se connecter</button>
        </form>
        <form class="login-form" id="registerForm" style="display:none;">
            <input type="text" id="registerUser" placeholder="Nom d'utilisateur" required autocomplete="username">
            <input type="password" id="registerPass" placeholder="Mot de passe" required autocomplete="new-password">
            <button type="submit" class="button">Créer un compte</button>
        </form>
        <div id="authError" style="display:none;color:#ff6666;margin-top:12px;font-weight:600;"></div>
    </div>
    <script>
    // (debug helpers removed) -- normal behaviour restored

    // Tabs
    document.getElementById('tab-login').onclick = function() {
        this.classList.add('active');
        document.getElementById('tab-register').classList.remove('active');
        document.getElementById('loginForm').style.display = '';
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('authError').style.display = 'none';
    };
    document.getElementById('tab-register').onclick = function() {
        this.classList.add('active');
        document.getElementById('tab-login').classList.remove('active');
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('registerForm').style.display = '';
        document.getElementById('authError').style.display = 'none';
    };

    // Login/register sans aucune vérification, tout passe
    document.getElementById('registerForm').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('registerUser').value.trim();
        const password = document.getElementById('registerPass').value.trim();

        if (!username || !password) {
            document.getElementById('authError').textContent = "Veuillez renseigner un nom d'utilisateur et un mot de passe";
            document.getElementById('authError').style.display = 'block';
            return;
        }

        try {
            const response = await fetch('register.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ username, password })
            });
            const result = await response.text();
            if (result === 'success') {
                localStorage.setItem('p4_user', username);
                // Show a clickable link instead of redirecting automatically so we can inspect the behavior
                document.getElementById('authError').style.display = 'none';
                const msg = document.createElement('div');
                msg.style.marginTop = '12px';
                msg.style.fontWeight = '600';
                msg.innerHTML = `Compte créé ✅ — <a href="http://127.0.0.1/power4-web/templates/menu/menu.html" id="goSiteLink">Aller au site</a>`;
                document.querySelector('.login-container').appendChild(msg);
                document.getElementById('goSiteLink').onclick = function(e) { e.preventDefault(); window.location.href = 'http://127.0.0.1/power4-web/templates/menu/menu.html'; };
            } else if (result === 'exists') {
                document.getElementById('authError').textContent = "Ce nom d'utilisateur est déjà pris.";
                document.getElementById('authError').style.display = 'block';
            } else {
                document.getElementById('authError').textContent = "Erreur lors de la création du compte.";
                document.getElementById('authError').style.display = 'block';
            }
        } catch (err) {
            document.getElementById('authError').textContent = "Erreur réseau — réessayez plus tard.";
            document.getElementById('authError').style.display = 'block';
        }
    };

    document.getElementById('loginForm').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('loginUser').value.trim();
        const password = document.getElementById('loginPass').value.trim();

        // Simple client-side validation
        if (!username || !password) {
            document.getElementById('authError').textContent = "Veuillez renseigner le nom d'utilisateur et le mot de passe";
            document.getElementById('authError').style.display = 'block';
            return;
        }

        try {
            const response = await fetch('login.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ username, password })
            });

            const result = await response.text();
            if (result === 'success') {
                localStorage.setItem('p4_user', username);
                document.getElementById('authError').style.display = 'none';
                const msg = document.createElement('div');
                msg.style.marginTop = '12px';
                msg.style.fontWeight = '600';
                msg.innerHTML = `Connexion réussie ✅ — <a href="http://127.0.0.1/power4-web/templates/menu/menu.html" id="goSiteLink2">Aller au site</a>`;
                document.querySelector('.login-container').appendChild(msg);
                document.getElementById('goSiteLink2').onclick = function(e) { e.preventDefault(); window.location.href = 'http://127.0.0.1/power4-web/templates/menu/menu.html'; };
            } else {
                document.getElementById('authError').textContent = "Nom d'utilisateur ou mot de passe incorrect";
                document.getElementById('authError').style.display = 'block';
            }
        } catch (err) {
            document.getElementById('authError').textContent = "Erreur réseau — réessayez plus tard.";
            document.getElementById('authError').style.display = 'block';
        }
    };
    // Si déjà connecté : ne pas rediriger automatiquement (évite les boucles avec l'index)
    // L'utilisateur peut cliquer sur "Continuer" pour aller au menu principal.
    if (localStorage.getItem('p4_user')) {
        const cont = document.createElement('div');
        cont.style.marginTop = '12px';
        cont.style.fontWeight = '600';
        cont.innerHTML = `Vous êtes déjà connecté en tant que <strong>${localStorage.getItem('p4_user')}</strong>. <button id="continueBtn" class="button" style="display:inline-block;min-width:140px;margin-left:12px;">Continuer</button>`;
        document.querySelector('.login-container').appendChild(cont);
        document.getElementById('continueBtn').onclick = function() {
            window.location.href = 'http://127.0.0.1/power4-web/templates/menu/menu.html';
        };
    }
    </script>
</body>
</html>
