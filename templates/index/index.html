<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Puissance 4</title>
    <link rel="stylesheet" href="/assets/style/style.css">
</head>
<body>
    <div id="difficultyModal" class="modal" style="display:flex;align-items:center;justify-content:center;">
        <div class="modal-content" style="max-width:350px;">
            <h2>Choisissez la difficult√©</h2>
            <form id="difficultyForm">
                <button type="submit" class="button" data-rows="6" data-cols="7" data-win="3">Easy<br><span style="font-size:0.9em;">6x7, 3 pions align√©s</span></button>
                <button type="submit" class="button" data-rows="6" data-cols="7" data-win="4">Classique<br><span style="font-size:0.9em;">6x7, 4 pions align√©s</span></button>
                <button type="submit" class="button" data-rows="6" data-cols="9" data-win="5">Normal<br><span style="font-size:0.9em;">6x9, 5 pions align√©s</span></button>
                <button type="submit" class="button" data-rows="7" data-cols="8" data-win="7">Hard<br><span style="font-size:0.9em;">7x8, 7 pions align√©s</span></button>
            </form>
        </div>
    </div>
    <div id="modeModal" class="modal" style="display:none;align-items:center;justify-content:center;">
        <div class="modal-content" style="max-width:350px;">
            <h2>Mode de jeu</h2>
            <button class="button" id="soloBtn">Solo (vs Bot)</button>
            <button class="button" id="multiBtn">Multijoueur</button>
        </div>
    </div>
    <div class="container" id="gameContainer" style="display:none;">
        <h1 id="gameTitle">Puissance 4</h1>
        
        <p id="message">Chargement...</p>
        <div id="board"></div>
        <button id="resetBtn" class="button">Recommencer</button>
        <a href="/" class="button" id="backMenuBtn">üè† Retour menu</a>
    </div>
    <script>
    // Difficult√© : modale au d√©marrage
    document.getElementById('difficultyForm').onclick = async function(e) {
        if (e.target.closest('button')) {
            e.preventDefault();
            const btn = e.target.closest('button');
            const rows = btn.getAttribute('data-rows');
            const cols = btn.getAttribute('data-cols');
            const win = btn.getAttribute('data-win');
            localStorage.setItem('p4_rows', rows);
            localStorage.setItem('p4_cols', cols);
            localStorage.setItem('p4_win', win);
            // Reset complet du backend pour appliquer la nouvelle config
            await fetch('/api/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ rows: parseInt(rows, 10), cols: parseInt(cols, 10), win: parseInt(win, 10) })
            });
            await fetch('/api/reset', { method: 'POST' });
            // Affiche la modale de choix du mode
            document.getElementById('difficultyModal').style.display = 'none';
            document.getElementById('modeModal').style.display = 'flex';
        }
    };
    // Choix du mode de jeu
    document.getElementById('soloBtn').onclick = function() {
        localStorage.setItem('p4_mode', 'solo');
        document.getElementById('modeModal').style.display = 'none';
        document.getElementById('gameContainer').style.display = '';
        window.location.reload();
    };
    document.getElementById('multiBtn').onclick = function() {
        localStorage.setItem('p4_mode', 'multi');
        document.getElementById('modeModal').style.display = 'none';
        document.getElementById('gameContainer').style.display = '';
        window.location.reload();
    };
    // Pour √©viter l'affichage du jeu avant le choix
    if (!localStorage.getItem('p4_rows') || !localStorage.getItem('p4_cols') || !localStorage.getItem('p4_win')) {
        document.getElementById('difficultyModal').style.display = 'flex';
        document.getElementById('gameContainer').style.display = 'none';
        document.getElementById('modeModal').style.display = 'none';
    } else if (!localStorage.getItem('p4_mode')) {
        document.getElementById('difficultyModal').style.display = 'none';
        document.getElementById('modeModal').style.display = 'flex';
        document.getElementById('gameContainer').style.display = 'none';
    } else {
        document.getElementById('difficultyModal').style.display = 'none';
        document.getElementById('modeModal').style.display = 'none';
        document.getElementById('gameContainer').style.display = '';
    }
    // Bouton retour menu : reset + retour + suppression config difficult√©
    document.getElementById('backMenuBtn').addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('p4_rows');
        localStorage.removeItem('p4_cols');
        localStorage.removeItem('p4_win');
        fetch('/api/reset', { method: 'POST' }).then(() => {
            window.location.href = '/';
        });
    });
    </script>
    <script>
    // Met √† jour dynamiquement le titre selon la difficult√©
    function updateTitleByDifficulty() {
        const win = localStorage.getItem('p4_win');
        let titre = 'Puissance 4';
        if (win === '3') titre = 'Puissance 3';
        else if (win === '4') titre = 'Puissance 4';
        else if (win === '5') titre = 'Puissance 5';
        else if (win === '7') titre = 'Puissance 7';
        document.getElementById('gameTitle').textContent = titre;
    }
    updateTitleByDifficulty();
    </script>
    <script src="/src/script/script.js"></script>
</body>
</html>
